---
title: "Final Project"
output: html_notebook
authors: "Evelyn Murray and Joseph Pevner"
---

```{r}
library(mosaic)
library(tidyverse)
library(lubridate)
library(DataComputing)
library(rvest)
library(broom)
```

## Research Focus:

As COVID-19 spreads at an alarming rate, a pressing question at a global scale emerges-- what factors of a country contribute to the spread of Coronavirus. The factors which we will analyze are: population density, and proximity to origin point (China).


## Data Access

# Reading in the Data:


Data Source 1: COVID
```{r}
COVID <- read.csv(file = "total-covid-cases-deaths-per-million.csv")
COVID
```

```{r}
COVID %>%
  nrow()
```
```{r}
COVID %>%
  names()
```
```{r}
COVID %>%
  head()
```



Data Source 2: CountryData
```{r}
CountryData
```

```{r}
CountryData %>%
  nrow()
```
```{r}
CountryData %>%
  names()
```
```{r}
CountryData %>%
  head()
```




### Data Wrangling of COVID Dataset

```{r}
COVID
```

Since our analysis is focused on the spread of COVID-19, we select only columns which pertain to the number of COVID-19 cases in countries over time.

```{r}
TidyCOVID <- COVID %>%
  rename(country = total.covid.cases.deaths.per.million ) %>%
  rename( Code = X ) %>%
  rename(date = X.1 ) %>%
  rename(casesPerMillion = X.3) %>%
  filter(row_number() > 1) %>%
  subset(select = c(1,3,5)) %>%
  mutate( country = as.character(country) ) %>%
  mutate(date = mdy(date)) %>%
  mutate(casesPerMillion = as.integer(casesPerMillion) - 1)


```


```{r}
TidyCOVID

```

WHAT DOES AN INSTANCE REPRESENT NOW??



Select CountryData relevant to our analysis: area (sq km), pop (number of people)
calculate new variable: popdensity: number of people per sq km

```{r}

RelevantCountryData <-
  CountryData %>%
  subset(select = c(1,2,3)) %>%
  mutate(popdensity = round(pop/area, digits = 2))

RelevantCountryData
```



```{r}

COVIDGrowth <- inner_join(TidyCOVID, RelevantCountryData, by = c("country"))

COVIDGrowth

```



Calculate the number of cases in each country by multiplying casesPerMillion by population (in millions). This variable is now a standardized metric with which we can compare countries.
```{r}

COVIDGrowth <-
  COVIDGrowth %>%
  mutate("cases" = (casesPerMillion * round(pop/1000000, digits = 0))) %>%
  subset(select = c("country", "date", "cases", "pop", "popdensity"))

COVIDGrowth
```




This table records the first date that a country recorded a nonzero number of COVID-19 cases.
```{r}

FirstInstance <-
  COVIDGrowth %>%
  filter(cases != 0) %>%
  group_by(country) %>%
  summarise(beginningofspread = min(date))
  
FirstInstance


```




This table averages the number of case increase per day from the first day a country had COVID-19 to the most recent in the data table (April 5 2020)

```{r}

DailySpread <-
  left_join(COVIDGrowth, FirstInstance, by = c("country")) %>%
  filter(date == "2020-04-05") %>%
  mutate(dayselapsed = date - beginningofspread) %>%
  mutate(dailyspread = cases / as.numeric(dayselapsed) ) %>%
  subset(select = c("country", "beginningofspread", "dailyspread"))

DailySpread$dailyspread[is.na(DailySpread$dailyspread)] <- 0

DailySpread
```



```{r}

COVIDFinal <-
  left_join(COVIDGrowth, DailySpread, by = c("country"))

```



```{r}
COVIDFinal

```


```{r}

COVIDFinal %>%
  group_by(date) %>%
  summarise(totalcases = sum(cases)) %>%
  ggplot(aes(x = date, y = totalcases)) + 
  geom_point() 

```







```{r}
  
COVIDFinal %>%
  group_by(country) %>%
  summarise(dailyspread = mean(dailyspread)) %>%
  arrange(desc(dailyspread)) %>%
  head(20) %>%
  ggplot(aes(x = reorder(country, desc(dailyspread)), y= dailyspread)) +
  geom_bar(stat="identity", position = 'stack', width=.9) +
  theme(axis.text.x=element_text(angle = 60, hjust = 1)) +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) +
  xlab("Country") +
  ylab("Spread of COVID-19 cases Per Day")



```






```{r}

COVIDFinal %>%
  ggplot(aes(x = pop, y = dailyspread)) + 
  geom_point()


```

