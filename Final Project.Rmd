---
title: "Final Project"
output: html_notebook
authors: "Evelyn Murray and Joseph Pevner"
---

```{r}
library(mosaic)
library(tidyverse)
library(lubridate)
library(DataComputing)
library(rvest)
library(broom)
```

## Research Focus:

As COVID-19 spreads at an alarming rate, a pressing question at a global scale emerges-- what factors of a country contribute to the spread of Coronavirus. We hope to analyze the relationship between population and average spread of COVID-19 across the six inhabeted continents.




## Data Access

### Reading in the Data:


#### Data Source 1: COVID
```{r}
COVID <- read.csv(file = "total-covid-cases-deaths-per-million.csv")
COVID
```

```{r}
COVID %>%
  nrow()
```
```{r}
COVID %>%
  names()
```
```{r}
COVID %>%
  head()
```



#### Data Source 2: CountryData
```{r}
CountryData
```

```{r}
CountryData %>%
  nrow()
```
```{r}
CountryData %>%
  names()
```
```{r}
CountryData %>%
  head()
```

#### Data Source 3: countryRegions

```{r}
countryRegions
```
```{r}
countryRegions %>%
  nrow()
```
```{r}
countryRegions %>%
  names()
```
```{r}
countryRegions %>%
  head()
```




## Data Wrangling

### Tidying the COVID Dataset

```{r}
COVID
```

Since our analysis is focused on the spread of COVID-19, we select only columns which pertain to the number of COVID-19 cases in countries over time.

```{r}
TidyCOVID <- COVID %>%
  rename(country = total.covid.cases.deaths.per.million ) %>%
  rename( Code = X ) %>%
  rename(date = X.1 ) %>%
  rename(casesPerMillion = X.3) %>%
  filter(row_number() > 1) %>%
  subset(select = c(1,2,3,5)) %>%
  mutate( country = as.character(country) ) %>%
  mutate(date = mdy(date)) %>%
  mutate(casesPerMillion = as.integer(casesPerMillion) - 1)


```


```{r}
TidyCOVID

```



EVELYN pls explain what an instance represents


### Wrangling of countryRegions Dataset

We will extract the ISO3 country code and continent from the countryRegions data. Since naming conventions of countries is variate, the ISO3 country code allows us a standardized demarcation of country with which to join with other data tables.

```{r}
Labels <-
  countryRegions %>%
  subset(select = c("ISO3", "REGION")) %>%
  rename(continent = REGION)

Labels

```


### Data Extraction of CountryData Dataset

We will select the aspects of CountryData relevant to our analysis. These attributes are: area (sq km) and pop (number of people).

```{r}

RelevantCountryData <-
  CountryData %>%
  subset(select = c(1,2,3))

RelevantCountryData
```

### Joining Data & Relevant Variable Synthesis

Calculate the number of cases in each country by multiplying casesPerMillion by population (in millions). This variable is now a standardized metric with which we can compare countries.
```{r}

COVIDGrowth <-
  inner_join(TidyCOVID, RelevantCountryData, by = c("country")) %>%
  mutate("cases" = (casesPerMillion * round(pop/1000000, digits = 0)))

COVIDGrowth <-
  COVIDGrowth %>%
  left_join(Labels, by = c("Code" = "ISO3"))

COVIDGrowth
```

### Creation of new Data Table: FirstInstance

This table records the first date that a country recorded a nonzero number of COVID-19 cases. This datagraph will help us visualize /bwhen/ countries first became infected.
```{r}

FirstInstance <-
  COVIDGrowth %>%
  filter(cases != 0) %>%
  group_by(country, continent) %>%
  summarise(beginningofspread = min(date))
  
FirstInstance


```




This table averages the number of case increase per day from the first day a country had COVID-19 to the most recent in the data table (April 5 2020)

```{r}

DailySpread <-
  left_join(COVIDGrowth, FirstInstance, by = c("country")) %>%
  filter(date == "2020-04-05") %>%
  mutate(dayselapsed = date - beginningofspread) %>%
  mutate(dailyspread = cases / as.numeric(dayselapsed) ) %>%
  subset(select = c("country", "beginningofspread", "dailyspread"))

DailySpread$dailyspread[is.na(DailySpread$dailyspread)] <- 0

DailySpread
```



```{r}

COVIDFinal <-
  left_join(COVIDGrowth, DailySpread, by = c("country"))

```



```{r}
COVIDFinal

```




```{r}

COVIDFinal %>%
  group_by(date) %>%
  summarise(totalcases = sum(cases)) %>%
  ggplot(aes(x = date, y = totalcases)) + 
  geom_point()

```
```{r}

na.omit(COVIDFinal) %>%
  group_by(date, continent) %>%
  summarise(totalcases = sum(cases)) %>%
  ggplot(aes(x = date, y = totalcases)) + 
  geom_point() +
  facet_wrap(~continent)

```



```{r}
  
COVIDFinal %>%
  group_by(country) %>%
  summarise(dailyspread = mean(dailyspread)) %>%
  arrange(desc(dailyspread)) %>%
  head(20) %>%
  ggplot(aes(x = reorder(country, desc(dailyspread)), y= dailyspread)) +
  geom_bar(stat="identity", position = 'stack', width=.9) +
  theme(axis.text.x=element_text(angle = 60, hjust = 1)) +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) +
  xlab("Country") +
  ylab("Spread of COVID-19 cases Per Day")



```






```{r}

na.omit(COVIDFinal) %>%
  ggplot(aes(x = pop, y = dailyspread, color = continent)) + 
  geom_point()


```



WITHOUT OUTLIERS SHOWS STILL STRONG POSITIVE CORRELATION

```{r}

na.omit(COVIDFinal) %>%
  ggplot(aes(x = pop, y = dailyspread, color = continent)) + 
  geom_point() +
  xlim(0,500000000)
  ylim(0, 40000)


```





```{r}

na.omit(FirstInstance) %>%
  ggplot(aes(x = beginningofspread, fill = continent)) +
  geom_dotplot(stackgroups = TRUE, binwidth = 1, binpositions="all") +
  xlab("Country's First Case of COVID-19") +
  theme(panel.background = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.title.y = element_blank())
```





